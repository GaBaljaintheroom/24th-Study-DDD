# 아키텍처 개요


## 2.1 네 개의 영역
> 표현(presentation), 응용(application), 도메인(domain), 인프라스트럭처(infrastructure)
<img width="404" alt="image" src="https://github.com/gmkim20713/24th-Study-DDD/assets/68195241/aa155b5e-1e3f-4ec7-9f9c-cfa4719fdd54">

### 표현
- 사용자의 요청을 받아 응용 영역에 전달, 응용 영역의 처리 결과를 다시 사용자에게 보여주는 역할
  - 스프링 MVC 프레임워크가 표현 영역을 위한 기술에 해당한다.
  - 웹 애플리케이션에서 표현 영역의 사용자는 웹 브라우저를 사용하는 사람일 수도 있고, REST API를 효출하는 외부 시스템일 수도 있다.
  - HTTP 요청을 응용 영역이 필요로 하는 형식으로 변환해서 응용 영역에 전달하고 응용 영역의 응답을 HTTP 응답으로 변환하여 전송한다.

### 응용
<img width="257" alt="image" src="https://github.com/gmkim20713/24th-Study-DDD/assets/68195241/83166793-68c1-4a55-b2b3-a922cff6586b">

- 표현 영역의 사용자 요청을 전달받음, 시스템이 사용자에게 제공해야 할 기능을 구현
  - 기능을 구현하기 위해 도메인 영역의 도메인 모델을 사용한다.
  - 응용 서비스는 로직을 직접 수행하기보다는 도메인 모델에 로직 수행을 위임한다.

### 도메인
- 도메인 모델을 구현
  - 도메인 모델은 도메인의 핵심 로직을 구현한다.

### 인프라스트럭처 영역
<img width="254" alt="image" src="https://github.com/gmkim20713/24th-Study-DDD/assets/68195241/a68a92f1-d27c-49a5-b160-4bf551e801e2">

- 구현 기술에 대한 것을 다룸, 논리적인 개념을 표현하기보다는 실제 구현을 다룸
  - RDBMS 연동을 처리한다.
  - 메시징 큐에 메시지를 전송하거나 수신하는 기능을 구현한다.
  - MongoDB나 Redis와의 데이터 연동을 처리한다.
  - SMTP를 이용한 메일 발송 기능을 구현한다.
  - HTTP 클라이언트를 이용해서 REST API를 호출하는 것을 처리한다.
  - 도메인, 응용, 표현 영역은 구현 기술을 사용한 코드를 직접 만들지 않는 대신, 인프라스트럭처 영역에서 제공하는 기능을 사용해서 필요한 기능을 개발한다.


## 2.2 계층 구조 아키텍처
<img width="197" alt="image" src="https://github.com/gmkim20713/24th-Study-DDD/assets/68195241/50ade17b-c0d0-4e0a-9e51-41d7c5d84b80">

- 계층 구조는 상위 계층에서 하위 계층으로의 의존만 존재하고 하위 계층은 상위 계층에 의존하지 않는다.
  - 구현의 편리함을 위해 계층 구조를 유연하게 적용하기도 한다.

<img width="390" alt="image" src="https://github.com/gmkim20713/24th-Study-DDD/assets/68195241/7c40fa7b-af9b-4368-9ca3-4c92bb07014b">

- 하지만 표현, 응용, 도메인 계층이 상세한 구현 기술을 다루는 인프라스트럭처 계층에 종속된다.

### 인프라스트럭처에 의존하는 것의 문제
1. 테스트 어려움
2. 기능 확장의 어려움

-> ```해답``` DIP

## 2.3 DIP

### 고수준 모듈 & 저수준 모듈
- 고수준 모듈 : 의미 있는 단일 기능을 제공하는 모듈
  - 고수준 모듈의 기능을 구현하려면 여러 하위 기능이 필요하다.
- 저수준 모듈 : 하위 기능을 실제로 구현한 것

<img width="382" alt="image" src="https://github.com/gmkim20713/24th-Study-DDD/assets/68195241/6a1bc6ed-594a-40df-a9c6-2e2e3c25cad7">

> ```문제``` 고수준 모듈이 저수준 모듈을 사용하면 구현 변경과 테스트가 어렵다는 문제가 발생한다.

### DIP (의존 역전 원칙)
- 저수준 모듈이 고수준 모듈에 의존하도록 바꾼다. ➡️ 추상화한 인터페이스

<img width="337" alt="image" src="https://github.com/gmkim20713/24th-Study-DDD/assets/68195241/f5b37612-52e4-4d17-99cf-08ad0654f980">

### DIP 주의사항
> DIP의 핵심은 고수준 모듈이 저수준 모듈에 의존하지 않도록 하기 위함이다.

- 문제 상황 : 저수준 모듈에서 인터페이스를 추출하는 경우
   - 도메인 영역이 구현 기술을 다루는 인프라스트럭처 영역에 의존한다. (고수준 모듈이 저수준 모듈에 의존)
<img width="354" alt="image" src="https://github.com/gmkim20713/24th-Study-DDD/assets/68195241/6e003090-a7f1-4f69-8ced-66e5020e460e">

- DIP를 적용할 때 하위 기능을 추상화한 인터페이스는 고수준 모듈 관점에서 도출한다.

### DIP와 아키텍처
- 저수준 모듈 : 인프라스트럭처 영역
- 고수준 모듈 : 응용 영역, 도메인 영역


## 2.4 도메인 영역의 주요 구성요소

<img width="520" alt="image" src="https://github.com/gmkim20713/24th-Study-DDD/assets/68195241/c14bf409-86af-44e6-882e-5ba0db0c2fbb">

### 엔티티와 밸류
- 실제 도메인 모델의 엔티티 != DB 관계형 모델의 엔티티
  - 도메인 모델의 엔티티 : 데이터와 함께 도메인 기능을 제공하는 객체 (도메인 관점에서 기능을 구현하고 기능 구현을 캡슐화해서 데이터가 임의로 변경되는 것을 막음)
    - 두 개 이상의 데이터가 개념적으로 하나인 경우 밸류 타입을 이용해서 표현할 수 있다.
  - DB 관계형 모델의 엔티티
    - 밸류 타입을 제대로 표현하기 힘들다.

### 애그리거트
- 애그리거트 : 관련 객체를 하나로 묶은 군집
- 애그리거트르르 사용하면 개별 객체가 아닌 관련 객체를 묶어서 객체 군집 단위로 모델을 바라볼 수 있게 된다.
- 루트 엔티티 : 군집에 속한 객체를 관리, 애그리거트에 속해 있는 엔티티와 밸류 객체를 이용해서 애그리거트가 구현해야 할 기능을 제공

### 리포지터리
- 리포지터리 : 구현을 위한 도메인 모델, 애그리거트 단위로 도메인 객첼글 저장하고 조회하는 기능을 정의
- 도메인 모델을 사용해야 하는 코드는 리포지터리를 통해서 도메인 객체를 구한 뒤에 도메인 객체의 기능을 실행한다.
- 응용 서비스는 의존 주입과 같은 방식을 사용해서 실제 리포지터리 구현 객체에 접근한다.
  - 리포지터리는 응용 서비스가 필요로 하는 메서드를 제공
    1. 애그리거트를 저장하는 메서드
    2. 애그리거트 루트 식별자로 애그리거트를 조회하는 메서드


## 2.5 요청 처리 흐름
<img width="523" alt="image" src="https://github.com/gmkim20713/24th-Study-DDD/assets/68195241/078ba979-bd95-4dfb-835d-19d771544b72">


## 2.6 인프라스트럭처 개요
- 인프라스트럭처는 표현 영역, 응용 영역, 도메인 영역을 지원한다.
- 도메인 객체의 영속성 처리, 트랜잭션, SMTP 클라이언트, REST 클라이언트 등 다른 영역에서 필요로 하는 프레임워크, 구현 기술, 보조 기능을 지원한다.
- 도메인 영역과 응용 영역에서 정의한 인터페이스를 인프라스트럭처 영역에서 구현하는 것이 시스템을 더 유연하고 쉽게 만들어준다.
  - 하지만 무조건 인프라스트럭처에 대한 의존을 없앨 필요는 없다. (@Transactional, @Table, @Entity 같은 애너테이션을 사용하는 것이 편리한 경우)


## 2.7 모듈 구성
- 도메인이 크면 하위 도메인으로 나누고, 각 하위 도메인마다 별도 패키지를 구성한다.
- 도메인 모듈은 도메인이 속한 애그리거트를 기준으로 다시 패키지를 구성한다.
- 애그리거트, 모델, 리포지터리는 같은 패키지에 위치시킨다.
  - 도메인이 복잡하면 도메인 모델과 도메인 서비스를 별도 페키지에 위치시킬 수도 있다.
- 응용 서비스도 도메인 별로 페키지를 구분할 수 있다.


