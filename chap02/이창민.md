# 2. 아키텍쳐 개요

## 2.1 네 개의 영역
도메인 주도 설계(DDD)에서 아키텍처를 설계할 때 나타나는 전형적인 네 가지 영역

- **표현 영역** 
  - 웹 애플리케이션에서 HTTP 요청을 응용 영역이 필요로 하는 형식으로 변환하여 전달하고, 응용 영역의 응답을 HTTP 응답으로 변환하여 전송함.
- **응용 영역** 
  - 시스템이 사용자에게 제공해야 할 기능을 구현함.
  - 실제 비즈니스 로직을 직접 수행하기보다는 도메인 모델에 로직 수행을 위임함.
- **도메인 모델** 
  - 도메인의 핵심 로직을 구현함.
- **인프라스트럭처 영역** 
  - 논리적인 개념을 표현하기보다는 실제 구현 기술 처리를 담당함.

## 2.2 계층 구조 아키텍처
계층 구조는 상위 계층에서 하위 계층으로의 의존만 존재하고, 하위 계층은 상위 계층에 의존하지 않음.

- **문제점**: 표현, 응용, 도메인 계층이 인프라스트럭처 계층에 종속될 때 발생하는 문제
  - **테스트**: 구현 방식에 종속되어 구현 방식 변경이 힘들어짐.
  - **해결책**: DIP(의존 역전 원칙)를 통해 해결 가능

## 2.3 DIP (Dependency Inversion Principle)
고수준 모듈이 저수준 모듈을 사용하면 문제 발생. 저수준 모듈이 추상화한 인터페이스를 사용해서 고수준 모듈에 의존하게 해야 함. 이를 DIP(의존 역전 원칙)이라고 부름.

- 상속은 의존의 다른 형태임.
- 저수준 모듈에서 인터페이스를 추출하는 것은 의미가 없음. 도메인 관점에서 인터페이스를 도출해야 함.

## 2.4 도메인 영역의 주요 구성요소
- **엔티티 (ENTITY)**
  - 고유의 식별자를 갖는 객체로, 자신의 라이프 사이클을 가짐. 도메인의 고유한 개념을 포함함.
  - 단순히 데이터를 담고 있는 구조가 아니라, 데이터와 함께 도메인 기능을 제공하는 객체임.
  - 도메인 관점에서 기능을 구현하고, 기능 구현을 캡슐화하여 데이터가 임의로 변경되는 것을 막음.
  - 두 개 이상의 데이터가 개념적으로 하나인 경우, 밸류 타입을 이용해서 표현 가능.

- **밸류 (VALUE)**
  - 고유의 식별자를 갖지 않는 객체로, 주로 개념적으로 하나인 값을 의미함.
  - 엔티티의 밸류 타입 데이터를 변경할 때는 객체 자체를 완전히 교체함.

- **에그리거트 (AGGREGATE)**
  - 연관된 엔티티와 밸류 객체를 개념적으로 하나로 묶은 것임.
  - 도메인 모델에서 전체 구조를 이해하는 데 도움이 됨.
  - 루트 엔티티는 에그리거트에 속해 있는 엔티티와 밸류 객체를 이용해서 에그리거트가 구현해야 할 기능을 제공함.

- **리포지터리 (REPOSITORY)**
  - 에그리거트 단위로 도메인 모델의 영속성을 처리함.
  - 응용 서비스는 필요한 도메인 객체를 구하거나 저장할 때 리포지터리를 사용함.
  - 응용 서비스는 트랜잭션을 관리하는데, 트랜잭션 처리는 리포지터리 구현 기술의 영향을 받음.

- **도메인 서비스 (DOMAIN SERVICE)**
  - 특정 엔티티에 속하지 않은 도메인 로직을 제공함.

## 2.5 요청 처리 흐름
- **표현 영역**
  - 사용자가 전송한 데이터 형식이 올바른지 검사하고, 문제가 없다면 데이터를 이용해서 응용 서비스에 기능 실행을 위임함.
  - 사용자가 전송한 데이터를 응용 서비스가 요구하는 형식으로 변환하여 전달함.

- **응용 서비스 영역**
  - 도메인 모델을 이용해서 기능을 구현함.

## 2.6 인프라스트럭처 개요
표현 영역, 응용 영역, 도메인 영역에 프레임워크, 구현 기술, 보조 기능을 지원함.

고수준 인터페이스를 인프라스트럭처 영역에서 구현하는 것이 시스템을 더 유연하고 테스트하기 쉽게 만듦.

## 2.7 모듈 구성
아키텍처의 각 영역은 별도 패키지에 위치함.

도메인이 크면 하위 도메인으로 나누고, 각 하위 도메인마다 별도 패키지를 구성함.

에그리거트, 모델, 리포지터리는 같은 패키지에 위치시키고, 한 패키지에 가능하면 10~15개 미만으로 타입 개수를 유지하려고 노력함.