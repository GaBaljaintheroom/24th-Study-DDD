# 도메인 모델 시작하기


## 1.1 도메인이란?
> 도메인 : 소프트웨어로 해결하고자 하는 문제 영역

### 하위 도메인
- 한 도메인은 몇 개의 하위 도메인으로 나눌 수 있다.
- 한 하위 도메인은 다른 하위 도메인과 연동하여 완전한 기능을 제공한다.
- 같은 용어라도 하위 도메인마다 의미가 달라질 수 있다.

### 도메인의 특징
- 특정 도메인을 위한 소포프트웨어가 도메인이 제공해야 할 모든 기능을 직접 구현하는 것은 아니다.
- 도메인마다 고정된 하위 도메인이 존재하는 것은 아니다. ➡️ 하위 도메인을 어떻게 구성할지 여부는 상황에 따라 달라진다.


## 1.2 도메인 전문가와 개발자 간 지식 공유
> ```목표``` 요구사항을 올바르게 이해하는 것

### 권장 방법
1. 도메인 전문가와 직접 대화하기
   - 개발자와 도메인 전문가 사이에 내용을 전파하는 전달자가 많을수록 정보 왜곡과 손실이 발생한다.
2. 도메인에 대한 지식을 갖추기
   - 제품 개발과 관련된 도메인 전문가, 관계자, 개발자가 같은 지식을 공유하며 소통할수록 도메인 전문가가 원하는 제품을 만들 가능성이 높아진다.


## 1.3 도메인 모델
> 도메인 모델 : 특정 도메인을 개념적으로 표현한 것, 도메인 자체를 이해하기 위한 개념 모델

### 도메인 모델의 장점
- 여러 관계자들이 동일한 모습으로 도메인을 이해하고 도메인 지식을 공유하는 데 도움이 된다.

### 도메인 모델링 표현 방식
- 도메인을 이해하는 데 도움이 된다면 표현 방식이 무엇인지는 중요하지 않다.
  - 객체(클래스 다이어그램) ➡️ 기능과 데이터를 함께 보여주고자 할 때
  - 상태 다이어그램 ➡️ 상태 별 진행 내용이 중요할 때
  - 그래프 ➡️ 관계가 중요할 때
  - 수학 공식 ➡️ 계산 규칙이 중요할 때

|객체를 이용한 도메인 모델|상태 다이어그램을 이용한 도메인 모델|
|:---:|:---:|
|<img width="448" alt="image" src="https://github.com/gmkim20713/24th-Study-DDD/assets/68195241/4a0b4cc1-60c3-49bb-ac9d-5acb39ac7a89">|<img width="454" alt="image" src="https://github.com/gmkim20713/24th-Study-DDD/assets/68195241/75e42e04-e97f-432c-aa81-9106374e48a2">|

### 개념 모델 ➡️ 구현 모델
- 개념 모델은 데이터베이스, 트랜잭션 처리, 성능, 구현 기술과 같은 것을 고려하고 있지 않다. ⬅️ 구현 모델의 필요성
- 프로젝트 초기에는 개요 수준의 개념 모델로 도메인에 대한 전체 윤곽을 이해하는 데 집중하고, 구현하는 과정에서 개념 모델을 구현 모델로 점진적으로 발전시켜 나가야 한다.


## 1.4 도메인 모델 패턴
> 도메인 모델 : 도메인 계층을 구현할 때 사용하는 객체 모델 (1.3에서 설명한 정의와 다름)<br>도메인 모델 패턴 : 도메인 규칙을 객체 지향 기법으로 구현하는 패턴

### 아키텍처 구성 : 도메인 계층이란?
|영역|설명|
|:---|:---|
|Presentation|- 사용자 요청 처리<br>- 사용자에게 정보를 보여줌<br><br>_*사용자 : 소프트웨어를 사용하는 사람 & 외부 시스템_|
|Application|- 사용자 요청 기능 실행<br>(업무 로직을 직접 구현하지 않으며, 도메인 계층을 조합해서 기능 실행) |
|Domain|- 시스템이 제공할 도메인 규칙을 구현|
|Infrastructure|- 데이터베이스나 메시징 시스템과 같은 외부 시스템과의 연동 처리|


## 1.5 도메인 모델 도출
- 요구사항을 바탕으로 핵심 구성 요소, 규칙, 기능을 찾아 도메인 모델을 도출한다.


## 1.6 엔티티와 밸류
> 도메인 모델의 구분 : 엔티티 & 밸류

### 엔티티
- 특징 : 식별자를 가진다
- 식별자는 엔티티 객체마다 고유하며, 엔티티를 생성/수정(속성 바꿈)/삭제할 때까지 유지된다.
- 두 엔티티 객체의 식별자가 같으면 두 엔티티는 같다고 판단할 수 있다.

### 엔티티의 식별자 생성
- 엔티티의 식별자를 생성하는 시점은 도메인의 특징과 사용하는 기술에 따라 달라진다.
- 식별자 생성 방식
  - 특정 규칙에 따라 생성
    - 날짜를 사용해서 식별자를 생성하는 경우, 동시성 이슈를 고려해야 한다.
  - UUID나 Nano ID와 같은 고유 식별자 생성기 사용
  - 값을 직접 입력
    - 중복 입력 방지가 필요하다.
  - 일련번호 사용(시퀀스나 DB의 자동 증가 칼럼 사용)
 
### 밸류 타입
- 밸류 타입은 개념적으로 완전한 하나를 표현할 때 사용한다.
- 밸류 타입이 꼭 두 개 이상의 데이터를 가져야 하는 것은 아니다. ➡️ 의미를 명확하게 표현하기 위해 밸류 타입을 사용하는 경우도 있다.
- 밸류 타입을 위한 기능을 추가할 수 있다.
- 밸류 객체의 데이터를 변경할 때는 기존 데이터를 변경하기보다는 변경한 데이터를 갖는 새로운 밸류 객체를 생성하는 방식을 선호한다.
- 밸류 타입을 불변으로 구현하는 가장 중요한 이유는 안전한 코드를 작성할 수 있기 떄문이다.
  - 불변 객체는 참조 투명성과 스레드에 안전한 특징을 갖고 있다.
- 두 밸류 객체를 비교할 때는 모든 속성이 같은지 비교한다.

### 엔티티 식별자와 밸류 타입
- 엔티티 식별자의 실제 데이터는 String과 같은 문자열로 구성된 경우가 많다.
- 식별자는 단순한 문자열이 아니라 도메인에서 특별한 의미를 지니는 경우가 많기 때문에 식별자를 위한 밸류 타입을 사용해서 의미가 잘 드러나도록 할 수 있다.

#### 📌 Example
```java
public class Order {
  // OrderNo 타입 자체로 id가 주문번호임을 알 수 있다.
  private OrderNo id;
  ...

  public OrderNo getId() {
    return id;
  }
}
```

### ⚠️ K.I.M. - 도메인 모델에 set 메서드 넣지 않기
- set 메서드는 필드값만 변경하고 끝나기 때문에 상태 변경과 관련된 도메인 지식이 코드에서 사라지게 한다.
- set 메서드는 도메인 객체를 생성할 때 온전하지 않은 상태를 만들 수 있다.


## 1.7 도메인 용어와 유비쿼터스 언어
> 유비쿼터스 언어(Ubiquitous Language) : 도메인과 관련된 공통의 언어 (문서, 도메인 모델, 코드, 테스트 등 모든 곳에서 같은 용어를 사용)

### 권장 방법
- 의미를 변환하는 과정을 최소화하기
  - e.g., 👍 PREPARING, SHIPPED / 👎 STEP1, STEP2

### 유비쿼터스 언어의 장점
- 소통 과정에서 발생하는 용어의 모호함을 줄일 수 있다.
- 개발자는 도메인과 코드 사이에서 불필요한 해석 과정을 줄일 수 있다.
