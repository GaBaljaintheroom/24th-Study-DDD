# 7. 도메인 서비스


## 7.1 여러 애그리거트가 필요한 기능

도메인 영역의 코드를 작성하다보면, 한 애그리거트로 기능을 구현할 수 없을 때가 있다.

ex) 결제 금액 계산

- 상품 애그리거트
- 주문 애그래거트
- 할인 쿠폰 애그래거트
- 회원 애그리거트


한 애그리거트에 넣기 애매한 도메인 기능을 억지로 특정 애그리거트에 구현하면 안된다.

→ 의존성이 높아지고 코드가 복잡해짐

애그리거트의 범위를 넘어서는 도메인 개념이 애그리거트에 숨어들어 명시적으로 드러나지 않게 된다.
→ 해결 방법 : 도메인 기능을 별도 서비스로 구현

## 7.2 도메인 서비스

도메인 서비스 :  도메인 영역에 위치한 도메인 로직을 표현할 때 사용

- 계산 로직 : 여러 애그리거트가 필요한 계산 로직 등등
- 외부 시스템 연동이 필요한 도메인 로직: 구현하기 위해 타 시스템을 사용해야 하는 도메인 로직

도메인 서비스는 상태 없이 로직만 구현한다.

### 도메인 서비스 객체를 애그리거트에 주입하지 않기

애그리거트 메서드를 실행할 때, 도메인 서비스 객체를 파라미터로 전달하는 것은, 애그리거트가 도메인 서비스에 의존한다는 것을 의미한다.

때문에 애그리거트가 의존하는 도메인 서비스를 스프링 DI를 통해 의존 주입할 수 있지만 좋은 방법은 아니다.

도메인 객체는 필드와 메서드를 이용해서 개념적으로 하나인 모델을 의미함

 일부 기능을 위해 굳이 도메인 서비스 객체를 애그리거트에 의존 주입할 이유가 없음

- 애그리거트 메서드를 실행할 때 도메인 서비스를 인자로 전달하지 않고 도메인 서비스의 기능을 실행할 때 애그리거트를 전달하기도 함

도메인 서비스는 도메인 로직을 수행하지 응용 로직을 수행하지는 않음 

-> 트랜잭션 처리와 같은 로직은 응용 로직이므로 도메인 서비스가 아닌 응용 서비스에서 처리

### 응용 서비스 / 도메인 서비스 구분

- 해당 로직이 애그리거트의 상태를 변경하거나 애그리거트의 상태 값을 계산하는지 검사한다.
- 도메인 로직 (상태를 변경)이면서 한 애그리거트에 넣기에 적합하지 않는 경우 도메인 서비스로 구현한다.